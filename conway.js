window.conway=function(){var o=(t.prototype.get=function(t,e){return t<0&&(t=this.xMax-t),e<0&&(e=this.yMax-e),this.array[t%this.xMax][e%this.yMax]},t.prototype.forEach=function(t){for(var e=0;e<this.xMax;e++)for(var r=0;r<this.yMax;r++){var n=this.array[e][r];null!=n&&t({value:n,x:e,y:r})}},t);function t(t){for(var e=Math.max.apply(Math,t.map(function(t){return t.x}))+1,r=Math.max.apply(Math,t.map(function(t){return t.y}))+1,n=new Array(e),a=0;a<e;a++)n[a]=new Array(r);for(var i=0,o=t;i<o.length;i++){var u=o[i];n[u.x][u.y]=u.value}this.xMax=e,this.yMax=r,this.array=n}var i=(u.build=function(t){for(var e=t.getElementsByTagName("rect"),r=[],n=0;n<e.length;n++){var a=e[n],i="0"!==a.getAttribute("data-score");r.push({value:{element:a,state:i?"alive":"dead"},x:(Number(a.getAttribute("x"))-14)/13,y:(Number(a.getAttribute("y"))-14)/13})}return new u(new o(r))},u.injectStyle=function(t){var e=t.createElementNS("http://www.w3.org/1999/xhtml","link");e.setAttribute("href","./conway.css"),e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet");var r=t.getElementsByTagName("svg")[0];r.insertBefore(e,r.firstChild)},u.prototype.run=function(t){for(;t--;)if(this.nextStep())return!0;return!1},u.prototype.show=function(){this.board.forEach(function(t){var e=t.value;return e.element.setAttribute("data-conway-state",e.state)})},u.prototype.reset=function(){this.board.forEach(function(t){return t.value.element.setAttribute("data-conway-state","")})},u.prototype.getNeighbors=function(t,e){return[this.board.get(t-1,e-1),this.board.get(t,e-1),this.board.get(t+1,e-1),this.board.get(t-1,e),this.board.get(t+1,e),this.board.get(t-1,e+1),this.board.get(t,e+1),this.board.get(t+1,e+1)]},u.prototype.getNextState=function(t,e){var r=this.getNeighbors(t,e).filter(function(t){return null!=t&&"alive"===t.state}).length;return"alive"===this.board.get(t,e).state&&2===r||3===r?"alive":"dead"},u.prototype.nextStep=function(){var a=this;this.board.forEach(function(t){var e=t.value,r=t.x,n=t.y;return e.nextState=a.getNextState(r,n)});var n=!0;return this.board.forEach(function(t){var e=t.value,r=e.state;e.state=e.nextState,e.nextState=null,r!==e.state&&(n=!1)}),n},u);function u(t){this.board=t}return{init:function(e){i.injectStyle(e);function r(){var t=i.build(e);t.run(a+1)||a++,t.show()}function n(){if(!(a<=0)){var t=i.build(e);a--,t.run(a),t.show()}}var a=0;document.addEventListener("keydown",function(t){"n"===t.key?r():"b"===t.key?n():"r"===t.key&&function(){var t=i.build(e);a=0,t.reset()}()}),e.addEventListener("click",function(t){return t.preventDefault(),1===t.which&&r(),!1}),e.addEventListener("contextmenu",function(t){return t.preventDefault(),n(),!1})}}}();