"use strict";window.conway=function(){var o=function(t){for(var s,e,r=t.getElementsByTagName("rect"),n=[],a=0;a<r.length;a++){var u=r[a],o=(u.getAttribute("x")-14)/13,i=(u.getAttribute("y")-14)/13,f="0"!==u.getAttribute("data-score");n.push({x:o,y:i,value:{element:u,state:f?"alive":"dead"}})}return s=function(t){for(var a=-1,u=-1,e=0;e<t.length;e++){var r=t[e];r.x>a&&(a=r.x),r.y>u&&(u=r.y)}a++,u++;for(var o=new Array(a),n=0;n<a;n++)o[n]=new Array(u);for(var i=0;i<t.length;i++){var s=t[i];o[s.x][s.y]=s.value}return{get:function(t,e){return t<0&&(t=a-t),e<0&&(e=u-e),o[t%a][e%u]},forEach:function(t){for(var e=0;e<a;e++)for(var r=0;r<u;r++){var n=o[e][r];null!=n&&t(n,e,r)}}}}(n),e=function(){s.forEach(function(t,e,r){for(var n=[s.get(e-1,r-1),s.get(e,r-1),s.get(e+1,r-1),s.get(e-1,r),s.get(e+1,r),s.get(e-1,r+1),s.get(e,r+1),s.get(e+1,r+1)],a=0,u=0;u<n.length;u++){var o=n[u];null!=o&&"alive"===o.state&&a++}var i="alive"===t.state;i=i&&2===a||3===a,t.nextState=i?"alive":"dead"});var r=!0;return s.forEach(function(t){var e=t.state;t.state=t.nextState,t.nextState=null,e!=t.state&&(r=!1)}),r},{run:function(t){for(;t--;)if(e())return!0;return!1},show:function(){s.forEach(function(t){return t.element.setAttribute("data-conway-state",t.state)})},reset:function(){s.forEach(function(t){return t.element.setAttribute("data-conway-state","")})}}};return{init:function(a){!function(t){var e=t.createElementNS("http://www.w3.org/1999/xhtml","link");e.setAttribute("href","./conway.css"),e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet");var r=t.getElementsByTagName("svg")[0];r.insertBefore(e,r.firstChild)}(a);var u=0;document.addEventListener("keydown",function(t){if("n"===t.key){var e=o(a);e.run(u+1)||u++,e.show()}else if("b"===t.key&&0<u){var r=o(a);u--,r.run(u),r.show()}else if("r"===t.key){var n=o(a);u=0,n.reset()}})}}}();