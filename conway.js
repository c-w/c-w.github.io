"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}window.conway=function(){var f=function(){function f(t){_classCallCheck(this,f);for(var e=Math.max.apply(Math,_toConsumableArray(t.map(function(t){return t.x})))+1,r=Math.max.apply(Math,_toConsumableArray(t.map(function(t){return t.y})))+1,a=new Array(e),n=0;n<e;n++)a[n]=new Array(r);var i=!0,o=!1,u=void 0;try{for(var l,s=t[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;a[c.x][c.y]=c.value}}catch(t){o=!0,u=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}this._xMax=e,this._yMax=r,this._array=a}return _createClass(f,[{key:"get",value:function(t,e){return t<0&&(t=this._xMax-t),e<0&&(e=this._yMax-e),this._array[t%this._xMax][e%this._yMax]}},{key:"forEach",value:function(t){for(var e=0;e<this._xMax;e++)for(var r=0;r<this._yMax;r++){var a=this._array[e][r];null!=a&&t({value:a,x:e,y:r})}}}]),f}(),o=function(){function c(t){_classCallCheck(this,c),this._board=t}return _createClass(c,[{key:"_getNeighbors",value:function(t,e){return[this._board.get(t-1,e-1),this._board.get(t,e-1),this._board.get(t+1,e-1),this._board.get(t-1,e),this._board.get(t+1,e),this._board.get(t-1,e+1),this._board.get(t,e+1),this._board.get(t+1,e+1)]}},{key:"_getNextState",value:function(t,e){var r=this._getNeighbors(t,e).filter(function(t){return null!=t&&"alive"===t.state}).length;return"alive"===this._board.get(t,e).state&&2===r||3===r?"alive":"dead"}},{key:"_nextStep",value:function(){var n=this;this._board.forEach(function(t){var e=t.value,r=t.x,a=t.y;return e.nextState=n._getNextState(r,a)});var a=!0;return this._board.forEach(function(t){var e=t.value,r=e.state;e.state=e.nextState,e.nextState=null,r!=e.state&&(a=!1)}),a}},{key:"run",value:function(t){for(;t--;){if(this._nextStep())return!0}return!1}},{key:"show",value:function(){this._board.forEach(function(t){var e=t.value;return e.element.setAttribute("data-conway-state",e.state)})}},{key:"reset",value:function(){this._board.forEach(function(t){return t.value.element.setAttribute("data-conway-state","")})}}],[{key:"build",value:function(t){var e=t.getElementsByTagName("rect"),r=[],a=!0,n=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value,s="0"!==l.getAttribute("data-score");r.push({x:(l.getAttribute("x")-14)/13,y:(l.getAttribute("y")-14)/13,value:{element:l,state:s?"alive":"dead"}})}}catch(t){n=!0,i=t}finally{try{a||null==u.return||u.return()}finally{if(n)throw i}}return new c(new f(r))}},{key:"injectStyle",value:function(t){var e=t.createElementNS("http://www.w3.org/1999/xhtml","link");e.setAttribute("href","./conway.css"),e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet");var r=t.getElementsByTagName("svg")[0];r.insertBefore(e,r.firstChild)}}]),c}();return{init:function(n){o.injectStyle(n);var i=0;document.addEventListener("keydown",function(t){if("n"===t.key){var e=o.build(n);e.run(i+1)||i++,e.show()}else if("b"===t.key&&0<i){var r=o.build(n);i--,r.run(i),r.show()}else if("r"===t.key){var a=o.build(n);i=0,a.reset()}})}}}();