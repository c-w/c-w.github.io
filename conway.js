window.conway=function(){var i=(t.prototype.get=function(t,e){return t<0&&(t=this.xMax-t),e<0&&(e=this.yMax-e),this.array[t%this.xMax][e%this.yMax]},t.prototype.forEach=function(t){for(var e=0;e<this.xMax;e++)for(var r=0;r<this.yMax;r++){var a=this.array[e][r];null!=a&&t({value:a,x:e,y:r})}},t);function t(t){for(var e=Math.max.apply(Math,t.map(function(t){return t.x}))+1,r=Math.max.apply(Math,t.map(function(t){return t.y}))+1,a=new Array(e),n=0;n<e;n++)a[n]=new Array(r);for(var o=0,i=t;o<i.length;o++){var u=i[o];a[u.x][u.y]=u.value}this.xMax=e,this.yMax=r,this.array=a}var o=(u.build=function(t){for(var e=t.getElementsByTagName("rect"),r=[],a=0;a<e.length;a++){var n=e[a],o="0"!==n.getAttribute("data-score");r.push({value:{element:n,state:o?"alive":"dead"},x:(Number(n.getAttribute("x"))-14)/13,y:(Number(n.getAttribute("y"))-14)/13})}return new u(new i(r))},u.prototype.run=function(t){for(;t--;)if(this.nextStep())return!0;return!1},u.prototype.show=function(){this.board.forEach(function(t){t=t.value;return t.element.setAttribute("data-conway-state",t.state)})},u.prototype.reset=function(){this.board.forEach(function(t){return t.value.element.setAttribute("data-conway-state","")})},u.prototype.getNeighbors=function(t,e){return[this.board.get(t-1,e-1),this.board.get(t,e-1),this.board.get(t+1,e-1),this.board.get(t-1,e),this.board.get(t+1,e),this.board.get(t-1,e+1),this.board.get(t,e+1),this.board.get(t+1,e+1)]},u.prototype.getNextState=function(t,e){var r=this.getNeighbors(t,e).filter(function(t){return null!=t&&"alive"===t.state}).length;return"alive"===this.board.get(t,e).state&&2===r||3===r?"alive":"dead"},u.prototype.nextStep=function(){var a=this;this.board.forEach(function(t){var e=t.value,r=t.x,t=t.y;return e.nextState=a.getNextState(r,t)});var r=!0;return this.board.forEach(function(t){var e=t.value,t=e.state;e.state=e.nextState,e.nextState=null,t!==e.state&&(r=!1)}),r},u);function u(t){this.board=t}return{init:function(e){function r(){var t=o.build(e);t.run(n+1)||n++,t.show()}function a(){var t;n<=0||(t=o.build(e),n--,t.run(n),t.show())}var n=0;document.addEventListener("keydown",function(t){"n"===t.key?r():"b"===t.key?a():"r"===t.key&&(t=o.build(e),n=0,t.reset())}),e.addEventListener("click",function(t){return t.preventDefault(),1===t.which&&r(),!1}),e.addEventListener("contextmenu",function(t){return t.preventDefault(),a(),!1})}}}();